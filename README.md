# 1. 基本需求

需求 | 描述
:-:|:-:
全局唯一 | 可以利用时间的有序性, 并且在某个时间单元下采用自增序列
粗略有序 | 在分布式系统中, 难以做到绝对有序, 因此可以采用相对有序的方式
可反解 | 一个 ID 在生成后, 本身就带有很多信息量, 在存储层面可以省下传统的 timestamp 等字段.
高性能 | ID 生成取决于网络 I/O 和 CPU 的性能
高可用 | 在一台机器挂掉的时候, 请求必须能够转发到其他机器上, 远程服务宕机, 也需要有本地容错方案
可伸缩 | 业务量永远都在增长, 系统必须考虑后续扩展

# 2. 发布模式
根据最终的用户使用方式, 发布模式可以分为 `嵌入发布模式`, `中心服务器发布模式` 和 `REST` 发布模式

- 嵌入发布模式:

# 3. ID 类型
## 3.1 最大峰值型

    采用秒级有序, 秒级时间占 30 位, 序列号占 20 位

字段 | 版本 | 类型 | 生成方式 | 秒级时间 | 序列号 | 机器 ID
:-:|:-:|:-:|:-:|:-:|:-:|:-:|
位数 | 63 | 62 | 60 ~ 61 | 30 ~ 59 | 10 ~ 29 | 0 ~ 9

## 3.2 最小粒度型
    
    采用毫秒级生成, 毫秒级时间占用 40 位, 序列号占 10 位

字段 | 版本 | 类型 | 生成方式 | 秒级时间 | 序列号 | 机器 ID
:-:|:-:|:-:|:-:|:-:|:-:|:-:|
位数 | 63 | 62 | 60 ~ 61 | 20 ~ 59 | 10 ~ 19 | 0 ~ 9

最大峰值型能承受更大的峰值压力, 但是粗略有序的力度有点大; 最小粒度型有较细致的粒度, 但是每个毫秒能承受的理论峰值有限, 为 1024, 如果在同一个毫秒有更多的请求产生, 则必须等到下一个毫秒再响应.

# 4. 数据结构
## 4.1. 机器 ID
共 10 位, `2 ^ 10 = 1024`, 最多支持 1024 台服务器的集群

## 4.2 序列号
1. 最大峰值型: 理论上每秒支持 `2 ^ 20 = 1048576` 个 ID, 为百万级别
2. 最小粒度型: 理论上每毫秒支持 `2 ^ 10 = 1024` 个

## 4.3 秒级时间
1. 最大峰值型: 30 位